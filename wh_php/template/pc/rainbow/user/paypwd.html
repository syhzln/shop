<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>{$Think.lang.SecuritySettings}</title>
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/tpshop.css" />
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/myaccount.css" />
	<link rel="shortcut  icon" type="image/x-icon" href="__STATIC__/images/logo2.ico" media="screen"  />
	<script src="__STATIC__/js/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<body class="bg-f5">
<include file="user/header"/>
<div class="home-index-middle">
	<div class="w1224">
		<div class="g-crumbs">
			<a href="{:U('Home/User/index')}">{$Think.lang.MyMall}</a>
			<i class="litt-xyb"></i>
			<span>{$Think.lang.SecuritySettings}</span>
		</div>
		<div class="home-main">
			<include file="user/menu"/>
			<div class="ri-menu fr">
				<div class="menumain">
					<div class="goodpiece">
						<h1>{$Think.lang.SecuritySettings}</h1>
						<!--<a href=""><span class="co_blue">帮助</span></a>-->
					</div>
					<div class="accouun"></div>
					<div class="thirset ma-to-20">
						<div class="wshef <if condition='$step eq 1'>yellc</if>">1.{$Think.lang.VerifyIdentity}<i class="spassw"></i></div>
						<div class="wshef <if condition='$step eq 2'>yellc</if>">2.{$Think.lang.SetUpPaymentPassword}<i class="spassw"></i></div>
						<div class="wshef <if condition='$step eq 3'>yellc</if>">3.{$Think.lang.CarryOut}</div>
					</div>
					<if condition="$step eq 1">
						<div class="personerinfro verifyi">
							<form action="" method="post">
								<ul class="birth_jz">
									<li class="infor_wi_le"><a href="javascript:void(0);">{$Think.lang.PleaseSelectVerificationMethod}：</a></li>
									<li>
										<a href="javascript:void(0);">
											<select name="sender" id="sender" onchange="modify_sender(this)">
												<if condition="$user[mobile] neq ''"><option value="phone" rel="{$user.mobile}">{$Think.lang.PhoneVerification}</option></if>
												<!--<if condition="$user[email] neq ''"><option value="email" rel="{$user.email}">邮箱验证</option></if>-->
											</select>
										</a>
									</li>
								</ul>
								<ul class="name_jz ischecked">
									<if condition="$user[mobile] neq ''">
										<li class="infor_wi_le"><a href="javascript:void(0);">{$Think.lang.VerifiedPhoneNumber}：</a></li>
										<li><a href="javascript:void(0);" class="sender">{$user.mobile}</a></li>
										<else/>
										<!--<li class="infor_wi_le"><a href="javascript:void(0);">已验证邮箱号码：</a></li>-->
										<!--<li><a href="javascript:void(0);" class="sender">{$user.email}</a></li>-->
									</if>
								</ul>
								<ul class="name_jz checode">
									<li class="infor_wi_le"><a href="javascript:void(0);">{$Think.lang.VerificationCode}：</a></li>
									<li class="teaeu">
										<a href="javascript:void(0);">
											<input class="name_zjxs" type="text" name="tpcode" id="tpcode" value="">
										</a>
										<a href="javascript:void(0);">
											<input class="button_yzm" type="button" name="" onclick="sendcode(this)" value="{$Think.lang.GetVerificationCode}" />
										</a>
									</li>
								</ul>
								<ul class="hobby_jz">
									<li class="infor_wi_le"></li>
									<div class="save_s">
										<input class="save" type="button" id="" onclick="nextstep()" name="" value="{$Think.lang.NextStep}">
									</div>
								</ul>
							</form>
							<p class="las_ver">{$Think.lang.NotSamePasswordAsOtherWebsites}</p>
						</div>
					</if>
					<if condition="$step eq 2">
						<div class="personerinfro verifyi-next">
							<form action="" method="post" id="pwdform">
								<ul class="name_jz">
									<li class="infor_wi_le"><a href="javascript:void(0);">{$Think.lang.SetUpPaymentPassword}：</a></li>
									<li class="teaeu">
										<a href="javascript:void(0);">
											<!--<input class="name_zjxs" type="password" name="new_password" id="new_password" value=""placeholder="请输入6位数字密码" onkeyup="securityLevel(this.value)">-->
											<input class="name_zjxs" type="password" name="new_password" id="new_password" value=""placeholder="{$Think.lang.EnterSixDigitPassword}">
											<i class="qrzf"></i>
										</a>
										<!--<a class="safebil" href="javascript:void(0);">-->
											<!--<span>安全程度：</span>-->
											<!--<span class="lowzg red">低</span>-->
											<!--<span class="lowzg">中</span>-->
											<!--<span class="lowzg">高</span>-->
										<!--</a>-->
									</li>
								</ul>
								<ul class="name_jz">
									<li class="infor_wi_le"><a href="javascript:void(0);">{$Think.lang.ConfirmPaymentPassword}：</a></li>
									<li class="teaeu">
										<a href="javascript:void(0);">
											<input class="name_zjxs" type="password" name="confirm_password" id="confirm_password" value=""placeholder="{$Think.lang.EnterPasswordAgain}">
											<i class="qrzf"></i>
										</a>
									</li>
								</ul>
								<ul class="hobby_jz">
									<li class="infor_wi_le"></li>
									<div class="save_s">
										<input type="hidden" name="step" value="3">
										<input class="save" type="button" onclick="checkSubmit()" value="{$Think.lang.NextStep}">
									</div>
								</ul>
							</form>
							<p class="las-nex ma-to-20">1.{$Think.lang.NotSamePasswordAsOtherWebsites}</p>
							<p class="las-nex">2.{$Think.lang.RegularlyChangePaymentPassword}</p>
						</div>
					</if>
					<if condition="$step eq 3">
						<div class="oversuccen">
							<div class="zaiebox">
								<div class="fljair">
									<img src="__STATIC__/images/flj.png"/>
								</div>
								<div class="fljfon">
									<p>{$Think.lang.PasswordSetSuccessfully}</p>
									<p>{$Think.lang.RememberNewPassword}<a href="{:U('User/safety_settings')}">{$Think.lang.CheckSecuritySettings}</a></p>
								</div>
								<div class="diboback">
									<a href="/">{$Think.lang.GoHome}</a>
									<a href="{:U('Home/Cart/index')}">{$Think.lang.GoShoppingCart}</a>
								</div>
							</div>
						</div>
					</if>
				</div>
			</div>
		</div>
	</div>
</div>
<!--footer-s-->
<div class="footer p">
	<include file="public/footer_index" />
</div>
<!--footer-e-->
</body>
<script type="text/javascript">
    //显示密码安全等级
    function securityLevel(sValue) {
        var modes = 0;
        //正则表达式验证符合要求的
        if (sValue.length < 6 ) return modes;
        if (/\d/.test(sValue)) modes++; //数字
        if (/[a-z]/.test(sValue)) modes++; //小写
        if (/[A-Z]/.test(sValue)) modes++; //大写
        if (/\W/.test(sValue)) modes++; //特殊字符
//        $('.lowzg').eq(modes-1).addClass('red').siblings('.lowzg').removeClass('red');
    };
    function modify_sender(obj){
        $('.ischecked .infor_wi_le').children().html('{$Think.lang.PaymentPasswordVerified}'+$(obj).val());
        $('.sender').html($(obj).find("option:selected").attr('rel'));
    }
    function sendcode(o){
        $.ajax({
            url:'/index.php?m=Home&c=Api&a=send_validate_code&scene=6&t='+Math.random(),
            type:'get',
            dataType:'json',
            data:{type:$('#sender').val(),send:$('#sender').find("option:selected").attr('rel')},
            success:function(res){
                if(res.status==1){
                    layer.alert(res.msg, {icon: 1});
                    timer(o);
                }else{
                    layer.alert(res.msg, {icon: 2});
                }
            }
        })
    }

    var wait=120;
    function timer(o) {
        if (wait == 0) {
            o.removeAttribute("disabled");
            o.value="{$Think.lang.GetVerificationCode}";
            wait = 120;
        } else {
            o.setAttribute("disabled", true);
            o.value="{$Think.lang.Resend}(" + wait + ")";
            wait--;
            setTimeout(function() {
                timer(o)
            }, 1000)
        }
    }

    function nextstep(){
        var tpcode = $('#tpcode').val();
        if(tpcode == ''){
            layer.alert('{$Think.lang.VerificationMustFilled}', {icon: 2});
            return false;
        }
        if(tpcode.length != 6){
            layer.alert('{$Think.lang.VerificationCodeError}', {icon: 2});
            return false;
        }
        $.ajax({
            url:'/index.php?m=Home&c=Api&a=check_validate_code&t='+Math.random(),
            type:'post',
            dataType:'json',
            data:{type:$('#sender').val(),code:tpcode,send:$('#sender').find("option:selected").attr('rel'),scene:2},
            success:function(res){
                if(res.status==1){
                    is_check = true;
                    window.location.href='/index.php?m=Home&c=User&a=paypwd&step=2&t='+Math.random();
                }else{
                    layer.alert(res.msg, {icon: 2});
                    return false;
                }
            }
        })
    }

    function checkSubmit(){
        var new_password = $('#new_password').val();
        var confirm_password = $('#confirm_password').val();
        if(new_password == ''){
            layer.alert('{$Think.lang.PaymentPasswordCanNotBeEmpty}', {icon: 2});
            return false;
        }
        if(!isNumber(new_password)){
            layer.alert('{$Think.lang.EnterSixDigitPassword}', {icon: 2});
            return false;
        }
        if(new_password.length != 6){
            layer.alert('{$Think.lang.PaymentPasswordMustSixDigits}', {icon: 2});
            return false;
        }
        if(new_password != confirm_password){
            layer.alert('{$Think.lang.PasswordIsInconsistentTwice}', {icon: 2});
            return false;
        }
        $('#pwdform').submit();
    }

    function isNumber(value) {
        var patrn = /^(-)?\d+(\.\d+)?$/;
        if (patrn.exec(value) == null || value == "") {
            return false
        } else {
            return true
        }
    }
</script>
</html>