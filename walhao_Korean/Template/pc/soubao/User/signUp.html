<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">   
    <title>사용자 등록</title>
    <meta http-equiv="keywords" content="{$tpshop_config['shop_info_store_keyword']}" />
    <meta name="description" content="{$tpshop_config['shop_info_store_desc']}" />
    <link href="__STATIC__/css/reset.css" rel="stylesheet" />
    <link href="__STATIC__/css/reg3.css" rel="stylesheet" />
    <link rel='stylesheet' type='text/css' href='__STATIC__/css/common2.css'>    
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/common.min.css">
    <script type="text/javascript" src="__PUBLIC__/js/jquery-1.8.2.min.js"></script>
    <script src="__PUBLIC__/js/layer/layer.js"></script><!--弹窗js 参考文档 http://layer.layui.com/-->    
    <script src="__PUBLIC__/js/global.js"></script>
</head>
<body>
    <div class="regcon">
        <a class="m-fnlogoa fn-fl" href=""><img src="{$tpshop_config['shop_info_store_logo']}"/></a><span class="m-fntit">회원가입 환영합니다</span>
        <div class="ui_tab">
            <ul class="ui_tab_nav regnav">
                <!-- <li class="uli active "><a href="{:U('Home/User/register')}" >会员注册</a></li> -->
                <li class="no fn-fr loginbtn">이미 회원가입하신분<a href="{:U('Home/User/login')}"> 로그인 </a>하세요.</li>
            </ul>
<form id="reg_form2"  method="post" action="">
            <div class="ui_tab_content">
                <div class="m-fnbox ui_panel" style="display: block;">
                    <div class="fnlogin clearfix">
                        <div class="line">
                            <label class="linel" style="width:120px;"><span class="dt">추천 사람 ID：</span></label>
                            <div class="liner">
                                <input type="text" class="inp fmobile J_cellphone" placeholder="추천 사람 ID 입력하십시오."  name="referees"  onblur="chkRefereesId(this.value)" required=""/>
                                <p class="fn-fl errorbox v-txt" id="err_referees">추천 사람 ID 존재하지 않는다</p>
                            </div>
                        </div>
                        <!--   <div class="line">
                                  <label class="linel"><span class="dt">用户名：</span></label>
                                  <div class="liner">
                                      <input type="text" class="inp" placeholder="请输入用户名"  name="username" id="username" required="" maxlength="20" />
                                      <p class="fn-fl errorbox v-txt" id="err_username">请输入字母数字下划线或中文字符</p>
                                  </div>
                              </div>  -->
                        <div class="line">
                            <label class="linel" style="width:120px;"><span class="dt">핸드폰번호：</span></label>
                            <div class="liner">
                                <input type="text" class="inp fmobile J_cellphone" placeholder="핸드폰 번호를 입력하십시오."  name="mobile"  onblur="chkMobile(this.value)" required=""/>
                                <p class="fn-fl errorbox v-txt" id="err_mobile">핸드폰 번호 입력 정확하지 않다</p>
                            </div>
                        </div>  
                        <div class="line">
                            <label class="linel"style="width:120px;" ><span class="dt">이메일：</span></label>
                            <div class="liner">
                                <input type="text" class="inp" placeholder="이메일 주소 입력하십시오."  name="email" id="email"  onblur="chkEmail(this.value)"  required=""/>
                                <p class="fn-fl errorbox v-txt" id="err_email">이메일 주소 입력하십시오</p>
                            </div>
                        </div>      
                        <div class="line">
                            <label class="linel" style="width:120px;"><span class="dt">비밀번호설정：</span></label>
                            <div class="liner">
                                <input type="password" class="inp fpass J_password" placeholder="6-16 분 대소문자 알파벳, 숫자 또는 부호 조합" autocomplete="off" maxlength="16"  id="password" name="password" value="" required=""/>
                                <p class="fn-fl noticebox v-txt2" id="err_password">입력하십시오 6 - 16분 대소문자 영문, 숫자 또는 부호 조합</p>
                            </div>
                        </div>
                        <div class="line">
                            <label class="linel" style="width:120px;"><span class="dt">비밀번호확인：</span></label>
                            <div class="liner">
                                <input type="password" class="inp fsecpass J_password2" placeholder="비밀번호 다시 입력하십시오." autocomplete="off" maxlength="16" id="password2" name="password2" required="" value=""/>
                                <p class="fn-fl errorbox v-txt" id="err_password2">두 번 입력 암호 불일치</p>
                            </div>
                        </div>
						<div class="line">
                            <label class="linel" style="width:120px;"><span class="dt" >인증코드：</span></label>
                            <div class="liner">
                                <input type="text" class="inp imgcode J_imgcode" placeholder="인증 코드" id="verify_code2" name="verify_code" required=""/>
								<img width="100" height="35" src="/index.php/Home/User/verify/type/user_reg.html" id="reflsh_code2" onclick="verify('reflsh_code2')" class="po-ab to0">
                                <a><img onclick="verify('reflsh_code2')" src="__STATIC__/images/chg_image.png"  class="ma-le-210"></a>
                                <p class="fn-fl errorbox v-txt" id="err_verify_code">좀 검증 야드</p>
                            </div>
                            <div id="show-voice" class="show-voice"></div>
                        </div>
                        <div class="line liney clearfix">
                            <label class="linel">&nbsp;</label>
                            <div class="liner">
                               <!--  <div class="clearfix checkcon">
                                    <p class="fn-fl checktxt"><input type="checkbox" class="iyes fn-fl J_protocal" checked />
                                    <span class="fn-fl">我已阅读并同意</span><a class="itxt fn-fl" href="" target="_blank">《沃好商城服务协议》</a>
                                    </p>
                                      <p class="fn-fl errorbox v-txt" id="protocalBox"></p>
                                </div> -->
                                <a class="regbtn J_btn_agree" href="javascript:void(0);" onClick="check_submit();">가입하기</a>
                                <!-- <p class="v-txt" id="err_check_code"><span class="fnred">请勾选</span>我已阅读并同意<a class="itxt" href="" target="_blank">《沃好商城服务协议》</a></p> -->
                        </div>
                    </div>
                    </div>
                    </div>
            </div>
            </form>        
        </div>
    </div>    
</div>    
<include file="Public/footer1" />

<script type="text/javascript">
    $(document).ready(function(){
        
    });

    // 普通 图形验证码 
    function verify(id){
        $('#'+id).attr('src','/index.php?m=Home&c=User&a=verify&type=user_reg&r='+Math.random());
    }

    var isMobile =0;  //0 账号代表可用
    var isEmail =0;
    var isRefer =0;
    function check_submit(){
        var email =$('input[name="email"]').val();
        var mobile =$('input[name="mobile"]').val();
        var password = $('#password').val();
        var password2 = $('input[name="password2"]').val();
        var verify_code = $('input[name="verify_code"]').val();
        // var agree = $('input[type="checkbox"]:checked').val();
        var recommond_id = $('input[name="referees"]').val();
        var error = '';

        $("p[id^='err_']").each(function(){
            $(this).hide();
        });

       // (username == '') && $('#err_username').show();
       ($.trim($('#code').val()) == '') && $('#err_code').show();
       (password == '') && $('#err_password').show();
       (password2 != password) && $('#err_password2').show();
       (verify_code == '') && $('#err_verify_code').show();
        // (agree != 'on') && $('#err_check_code').show();
        if(recommond_id.length == 0){
            $('#err_referees').show();
            return false;
        }
        if(!checkMobile(mobile)){
            $('#err_mobile').show();
            return false;
        }
        if(!checkEmail(email)){
            $('#err_email').show();
            return false;
        }

        if(isMobile ==1){
            return false;
        }
        if(isEmail ==1){
            return false;
        }
        if(isRefer ==1){
            return false;
        }

        if($("p[id^='err_']:visible").length > 0 ){
          return false;
        }

        //提交数据
        $.ajax({
            type : "POST",
            url:"{:U('Home/User/signUp')}",
            dataType: "json",
            data: $('#reg_form2').serialize(),
            success: function(data){
                if(data.status == 1){
                    layer.msg(data.msg, {icon: 1},function(){
                        layer.confirm('로그인 ID 를 명심해 주십시오: '+data.wh_id, {
                            btn: ['확정하다','취소'] //按钮  确定 取消
                            ,title:'우호적인 힌트:'
                        }, function(){
                            window.location.href = "{:U('Home/User/login')}";
                        }, function(index){
                            layer.close(index);
                        });

                    });
                }else{
                    layer.alert(data.msg, {icon: 2},function(index){
                        $('.verifyImg').trigger('click');
                        layer.close(index);
                    });
                }
            }
        });




    }

    function checkMobile(tel) {
        var reg = /(^1[3|4|5|7|8][0-9]{9}$)/;
        var reg2 = /(\(\d{2,4}-\d{2,4}-\d{2,4}-\d{4,10}\)|\d{2,4}-\d{2,4}-\d{4,10})/;
        if (reg.test(tel) || reg2.test(tel)) {
            return true;
        }else{
            return false;
        };
    }
    function checkEmail(str){
        var reg = /^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        if(reg.test(str)){
            return true;
        }else{
            return false;
        }
    }
    //检测手机号是否已被使用
    function chkMobile(mobile){
        if(checkMobile(mobile)){
            $.ajax({
                type:'post',
                dataType:'json',
                data:{mobile:mobile},
                url:"{:U('Home/User/isUseMobile')}",
                success:function(data){
                    if(data ==1){
                        isMobile =1;
                        layer.alert('이 핸드폰 번호 중복됨',{icon:2});
                        return;
                    }else{
                        isMobile =0;
                    }                                      
                }
            });
        }
    }
    //检测邮箱是否已被使用
   function chkEmail(email){
        if(checkEmail(email)){
            $.ajax({
                type:'post',
                dataType:'json',
                data:{email:email},
                url:"{:U('Home/User/isUseEmail')}",
                success:function(data){
                    if(data==1){
                        isEmail =1;
                        layer.alert('이 메일 주소 중복됨',{icon:2});
                        return;
                    }else{
                        isEmail = 0;
                    }                  
                }
            });
        }
   }

    //检测推荐人id是否存在
    function chkRefereesId(referees){
        if(referees){
            $.ajax({
                type:'post',
                dataType:'json',
                data:{referees:referees},
                url:"/index.php?m=Home&c=User&a=checktuijian",
                success:function(data){
                    if(data ==1){
                        isRefer =1; //推荐人id不存在
                        layer.alert('추천 사람 ID 존재하지 않는다',{icon:2});
                        return;
                    }else{
                        isRefer = 0;  //存在  可以作为推荐人

                    }
                }
            });
        }
    }
</script> 
</body>

</html>
